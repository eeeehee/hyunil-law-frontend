<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒì›ê°€ì… - ê¸°ì—…ìë¬¸ì„¼í„°</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <style>
        /* [ìŠ¤íƒ€ì¼ ìœ ì§€] */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Pretendard Variable", Pretendard, sans-serif; }
        body { background-color: #f5f7fa; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        
        .register-container { background-color: #fff; padding: 50px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); width: 100%; max-width: 550px; }
        .register-title { font-size: 28px; font-weight: 800; text-align: center; margin-bottom: 40px; color: #1a1a1a; }
        
        .form-group { margin-bottom: 20px; }
        .label { display: block; font-weight: 700; margin-bottom: 8px; font-size: 14px; color: #333; }
        .label span { color: #ff4d4f; margin-left: 2px; }
        .input-box { width: 100%; height: 48px; padding: 0 15px; border: 1px solid #ddd; border-radius: 8px; font-size: 15px; outline: none; transition: 0.2s; }
        .input-box:focus { border-color: #1a1a1a; }
        
        .helper-text { font-size: 12px; color: #888; margin-top: 6px; line-height: 1.4; }
        .helper-text strong { color: #2c5bf2; } 
        
        .agreement-box { border: 1px solid #eee; background-color: #f9f9f9; padding: 15px; border-radius: 8px; margin-top: 30px; margin-bottom: 20px; }
        .agree-row { display: flex; align-items: center; margin-bottom: 10px; font-size: 14px; }
        .agree-row:last-child { margin-bottom: 0; }
        .agree-row input[type="checkbox"] { width: 18px; height: 18px; margin-right: 8px; cursor: pointer; accent-color: #1a1a1a; }
        .agree-row label { cursor: pointer; flex: 1; }
        .agree-all { border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 10px; font-weight: 700; }
        .btn-link { font-size: 12px; color: #888; text-decoration: underline; cursor: pointer; margin-left: 10px; }

        .btn-submit { width: 100%; height: 52px; background-color: #1a1a1a; color: #fff; border: none; border-radius: 8px; font-size: 16px; font-weight: 700; cursor: pointer; margin-top: 10px; transition: 0.2s; }
        .btn-submit:hover { background-color: #333; }
        
        .login-link { text-align: center; margin-top: 20px; font-size: 14px; color: #666; }
        .login-link a { color: #2c5bf2; text-decoration: none; font-weight: 700; }
        .login-link a:hover { text-decoration: underline; }
    </style>
</head>
<body>

    <div class="register-container">
        <h1 class="register-title">íšŒì›ê°€ì…</h1>
        
        <div class="form-group">
            <label class="label">ì´ë©”ì¼ (ì•„ì´ë””) <span>*</span></label>
            <input type="email" id="email" class="input-box" placeholder="example@company.com">
        </div>

        <div class="form-group">
            <label class="label">ë¹„ë°€ë²ˆí˜¸ <span>*</span></label>
            <input type="password" id="password" class="input-box" placeholder="6ìë¦¬ ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”">
        </div>

        <div class="form-group">
            <label class="label">íšŒì‚¬ëª… <span>*</span></label>
            <input type="text" id="companyName" class="input-box" placeholder="ë²•ì¸ëª… ë˜ëŠ” ìƒí˜¸">
        </div>

        <div class="form-group">
            <label class="label">ëŒ€í‘œì ì„±í•¨ <span>*</span></label>
            <input type="text" id="representativeName" class="input-box" placeholder="ì‚¬ì—…ìë“±ë¡ì¦ ìƒ ëŒ€í‘œìëª…">
        </div>

        <div class="form-group">
            <label class="label">ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ <span>*</span></label>
            <input type="text" id="bizNum" class="input-box" placeholder="ìˆ«ìë§Œ ì…ë ¥í•˜ì„¸ìš” (ìë™ í•˜ì´í”ˆ)" maxlength="12" oninput="autoHyphenBiz(this)">
        </div>

        <div class="form-group">
            <label class="label">íšŒì‚¬ ëŒ€í‘œ ì „í™”ë²ˆí˜¸ <span>*</span></label>
            <input type="text" id="companyPhone" class="input-box" placeholder="ì˜ˆ: 02-1234-5678">
        </div>

        <div class="form-group">
            <label class="label">ë‹´ë‹¹ì ì„±í•¨ <span>*</span></label>
            <input type="text" id="managerName" class="input-box" placeholder="ë³¸ì¸ ì„±í•¨ (ê°€ì…ì)">
        </div>

        <div class="form-group">
            <label class="label">ë‹´ë‹¹ì ì—°ë½ì²˜ (íœ´ëŒ€í°) <span>*</span></label>
            <input type="text" id="managerPhone" class="input-box" placeholder="ì˜ˆ: 010-1234-5678">
        </div>

        <div class="form-group">
            <label class="label">ì†Œì† ë¶€ì„œ</label>
            <input type="text" id="department" class="input-box" placeholder="ì˜ˆ: ì¸ì‚¬íŒ€ (ë¶€ì„œ êµ¬ë¶„ì´ ì—†ìœ¼ë©´ ë¹„ì›Œë‘ì„¸ìš”)">
            <p class="helper-text">
                â€» ë¶€ì„œì¥(Manager)ì€ í•´ë‹¹ ë¶€ì„œì˜ ê¸€ë§Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                â€» ì…ë ¥í•˜ì§€ ì•Šìœ¼ë©´ ìë™ìœ¼ë¡œ <strong>'ì „ì‚¬' ì†Œì†ìœ¼ë¡œ ê°„ì£¼</strong>ë©ë‹ˆë‹¤.
            </p>
        </div>

        <div class="form-group">
            <label class="label">ì§ì±… ë° ê¶Œí•œ <span>*</span></label>
            <select id="roleSelect" class="input-box">
                <option value="user">ì§ì› (Staff) - ë³¸ì¸ ë‚´ì—­ë§Œ ì¡°íšŒ</option>
                <option value="manager">ë¶€ì„œì¥ (Manager) - ì†Œì† ë¶€ì„œ ë‚´ì—­ ì¡°íšŒ</option>
                <option value="owner">ì´ê´„ê´€ë¦¬ì (CEO) - ì „ì²´ ì—´ëŒ ë° ê²°ì œ ê´€ë¦¬</option>
            </select>
        </div>

        <div class="agreement-box">
            <div class="agree-row agree-all">
                <input type="checkbox" id="agreeAll" onchange="toggleAllAgree()">
                <label for="agreeAll">ì „ì²´ ì•½ê´€ì— ë™ì˜í•©ë‹ˆë‹¤.</label>
            </div>
            <div class="agree-row">
                <input type="checkbox" id="agreeAge" class="essential-agree">
                <label for="agreeAge">[í•„ìˆ˜] ë§Œ 14ì„¸ ì´ìƒì…ë‹ˆë‹¤.</label>
            </div>
            <div class="agree-row">
                <input type="checkbox" id="agreeTerms" class="essential-agree">
                <label for="agreeTerms">[í•„ìˆ˜] ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ ë™ì˜</label>
                <span class="btn-link" onclick="window.open('terms.html', 'terms', 'width=600,height=700,scrollbars=yes')">ë³´ê¸°</span>
            </div>
            <div class="agree-row">
                <input type="checkbox" id="agreePrivacy" class="essential-agree">
                <label for="agreePrivacy">[í•„ìˆ˜] ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜</label>
                <span class="btn-link" onclick="window.open('consentPop.html', 'privacy', 'width=600,height=700,scrollbars=yes')">ë³´ê¸°</span>
            </div>
        </div>

        <button class="btn-submit" onclick="handleRegister()">ê°€ì…í•˜ê¸°</button>
        
        <div class="login-link">
            ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a href="../../pages/public/login.html">ë¡œê·¸ì¸í•˜ê¸°</a>
        </div>
    </div>

  <script type="module">
        import { auth } from "../../js/api.js";

        // ì‚¬ì—…ìë²ˆí˜¸ ìë™ í•˜ì´í”ˆ
        window.autoHyphenBiz = function(target) {
            target.value = target.value
                .replace(/[^0-9]/g, '')
                .replace(/^(\d{3})(\d{2})(\d{5})$/, `$1-$2-$3`);
        }

        window.toggleAllAgree = function() {
            const isChecked = document.getElementById('agreeAll').checked;
            document.getElementById('agreeAge').checked = isChecked;
            document.getElementById('agreeTerms').checked = isChecked;
            document.getElementById('agreePrivacy').checked = isChecked;
        }

        window.handleRegister = async function() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const companyName = document.getElementById('companyName').value;
            const representativeName = document.getElementById('representativeName').value;
            const bizNum = document.getElementById('bizNum').value;
            const companyPhone = document.getElementById('companyPhone').value;
            const managerName = document.getElementById('managerName').value;
            const managerPhone = document.getElementById('managerPhone').value;
            let department = document.getElementById('department').value;

            // 1. í•„ìˆ˜ê°’ ì²´í¬
            if (!email || !password || !companyName || !representativeName || !bizNum || !companyPhone || !managerName || !managerPhone) {
                alert("ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }
            if (password.length < 6) {
                alert("ë¹„ë°€ë²ˆí˜¸ëŠ” 6ìë¦¬ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
                return;
            }

            // 2. ì‚¬ì—…ìë²ˆí˜¸ ê¸¸ì´ ì²´í¬
            const cleanBizNum = bizNum.replace(/-/g, '');
            if (cleanBizNum.length !== 10) {
                alert("ğŸš¨ ìœ íš¨í•˜ì§€ ì•Šì€ ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ì…ë‹ˆë‹¤.\n(ìˆ«ì 10ìë¦¬ë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”)");
                return;
            }

            // 3. ì•½ê´€ ë™ì˜ ì²´í¬
            const agreeAge = document.getElementById('agreeAge').checked;
            const agreeTerms = document.getElementById('agreeTerms').checked;
            const agreePrivacy = document.getElementById('agreePrivacy').checked;

            if (!agreeAge || !agreeTerms || !agreePrivacy) {
                alert("í•„ìˆ˜ ì•½ê´€ì— ëª¨ë‘ ë™ì˜í•´ì£¼ì…”ì•¼ ê°€ì…ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
                return;
            }

            if (!department.trim()) {
                department = "ì „ì‚¬"; 
            }

            const btn = document.querySelector('.btn-submit');
            btn.innerText = "ê°€ì… ì²˜ë¦¬ ì¤‘...";
            btn.disabled = true;

            try {
                // APIë¡œ íšŒì›ê°€ì… ìš”ì²­
                await auth.signup({
                    email: email,
                    password: password,
                    companyName: companyName,
                    representativeName: representativeName,
                    bizNum: bizNum,
                    companyPhone: companyPhone,
                    managerName: managerName,
                    phone: managerPhone,
                    department: department
                });

                alert(`ê°€ì…ì„ í™˜ì˜í•©ë‹ˆë‹¤!\në¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.`);
                location.href = "/pages/public/login.html";

            } catch (error) {
                console.error("ê°€ì… ì—ëŸ¬:", error);
                let msg = error.message || "ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
                alert(msg);
                btn.innerText = "ê°€ì…í•˜ê¸°";
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>