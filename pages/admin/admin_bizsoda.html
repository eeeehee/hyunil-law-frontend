<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biz Soda ê´€ë¦¬ì - ë²•ë¬´ê·¸ë£¹ í˜„ì¼</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Pretendard Variable", Pretendard, sans-serif; }
        body { background-color: #f0f2f5; display: flex; min-height: 100vh; font-size: 14px; }

        /* ì‚¬ì´ë“œë°” */
        .sidebar { width: 260px; background-color: #1a1a2e; color: #fff; padding: 30px 20px; display: flex; flex-direction: column; position: fixed; height: 100vh; left: 0; top: 0; z-index: 100; overflow-y: auto; }
        .sidebar-brand { font-size: 20px; font-weight: 700; margin-bottom: 30px; padding-left: 10px; color: #fff; letter-spacing: 1px; }
        .sidebar-menu { list-style: none; padding: 0; margin-top: 10px; }
        .menu-category { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; color: #a6a6b5; font-size: 14px; font-weight: 700; cursor: pointer; transition: 0.2s; border-radius: 6px; margin-bottom: 2px; }
        .menu-category:hover { background-color: rgba(255, 255, 255, 0.05); color: #fff; }
        .menu-category.active { color: #fff; background-color: #2c2c45; }
        .menu-arrow { font-size: 10px; transition: 0.3s; color: #666; }
        .menu-category.open .menu-arrow { transform: rotate(180deg); color: #fff; }
        .submenu { display: none; padding-left: 10px; margin-bottom: 10px; background-color: rgba(0,0,0,0.1); border-radius: 6px; }
        .submenu li a { display: block; padding: 8px 15px 8px 32px; font-size: 13px; color: #888; border-radius: 4px; transition: 0.2s; position: relative; }
        .submenu li a:hover { color: #fff; background-color: rgba(255,255,255,0.05); }
        .submenu li a.active { color: #fff; font-weight: 700; background-color: #2c5bf2; }
        .menu-divider { border-top: 1px solid #2c2c45; margin: 15px 0; }
        .menu-link { display: block; padding: 12px 15px; border-radius: 8px; color: #a6a6b5; font-size: 14px; transition: 0.2s; text-decoration: none; }
        .menu-link:hover { background-color: #2c2c45; color: #fff; }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-content { flex: 1; margin-left: 260px; padding: 40px; overflow-y: auto; }

        /* ìƒë‹¨ í†µê³„ ì¹´ë“œ */
        .stats-container { display: flex; gap: 20px; margin-bottom: 30px; }
        .stat-card { flex: 1; background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; }
        .stat-title { color: #888; font-size: 13px; font-weight: 600; margin-bottom: 5px; }
        .stat-value { font-size: 28px; font-weight: 800; color: #333; }
        .stat-icon { font-size: 30px; opacity: 0.2; }

        /* íƒ­ ë©”ë‰´ */
        .admin-tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #ddd; }
        .tab-btn { padding: 12px 20px; background: none; border: none; font-weight: 700; color: #888; cursor: pointer; border-bottom: 3px solid transparent; font-size: 15px; }
        .tab-btn.active { color: #333; border-bottom-color: #333; }
        .tab-btn.legal.active { color: #d46b08; border-bottom-color: #d46b08; }

        /* í…Œì´ë¸” */
        .table-box { background: #fff; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); overflow: hidden; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f8f9fa; padding: 15px; text-align: left; font-weight: 700; color: #555; border-bottom: 1px solid #eee; }
        td { padding: 15px; border-bottom: 1px solid #f1f1f1; vertical-align: middle; }

        /* ë±ƒì§€ */
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 700; }
        .st-pending { background: #fff7e6; color: #d46b08; }
        .st-done { background: #f6ffed; color: #389e0d; }
        .st-review { background: #e6f7ff; color: #096dd9; }
        .st-rejected { background: #fff1f0; color: #cf1322; }

        /* ì•¡ì…˜ ë²„íŠ¼ */
        .btn-action { padding: 6px 12px; border-radius: 4px; border: 1px solid #ddd; background: #fff; cursor: pointer; font-weight: 600; font-size: 12px; }
        .btn-action:hover { background: #f8f9fa; }
        .btn-primary { background: #212529; color: #fff; border: none; }
        .btn-primary:hover { background: #333; }

        /* ëª¨ë‹¬ */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; justify-content: center; align-items: center; }
        .modal-box { background: #fff; width: 600px; max-height: 90vh; overflow-y: auto; padding: 30px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .modal-header { display: flex; justify-content: space-between; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .modal-title { font-size: 18px; font-weight: 800; }

        .form-label { display: block; font-weight: 700; color: #555; margin-bottom: 8px; margin-top: 15px; }
        .form-input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; }
        .form-textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; height: 100px; resize: vertical; }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="sidebar-brand">ADMINISTRATOR</div>
        <ul class="sidebar-menu">
            <li>
                <div class="menu-category" onclick="toggleAdminMenu('groupCorp', this)">
                    <div><span class="menu-icon">ğŸ¢</span> ê¸°ì—…ìë¬¸ì„¼í„°</div>
                    <span class="menu-arrow">â–¼</span>
                </div>
                <ul id="groupCorp" class="submenu">
                    <li><a href="admin.html">ğŸ“ ìë¬¸ ê´€ë¦¬ (ì „ì²´)</a></li>
                    <li><a href="admin_requests.html">ğŸ“© ìš”ì²­ ê´€ë¦¬í•¨</a></li>
                    <li><a href="admin_report.html">ğŸ“Š ë¦¬í¬íŠ¸ ë°œì†¡</a></li>
                    <li><a href="admin_corpbilling.html">ğŸ’¸ ìë¬¸ë£Œ ì²­êµ¬/ë°œì†¡</a></li>
                    <li><a href="admin_members.html">ğŸ‘¥ íšŒì›/ê¸°ì—… ê´€ë¦¬</a></li>
                    <li><a href="admin_payments.html">ğŸ’³ ë§¤ì¶œ/CMS ê´€ë¦¬</a></li>
                </ul>
            </li>

            <li>
                <div class="menu-category" onclick="toggleAdminMenu('groupLitigation', this)">
                    <div><span class="menu-icon">âš–ï¸</span> ì „ìì†Œì†¡/ì‚¬ê±´</div>
                    <span class="menu-arrow">â–¼</span>
                </div>
                <ul id="groupLitigation" class="submenu">
                    <li><a href="admin_litigation.html">ğŸ” ì „ìì†Œì†¡ ë°ì´í„° í™•ì¸</a></li>
                    <li><a href="admin_clients.html">ğŸ“‡ ë‹¹ì‚¬ì(ê³ ê°) ê´€ë¦¬</a></li>
                </ul>
            </li>

            <li>
                <div class="menu-category" onclick="toggleAdminMenu('groupSpecial', this)">
                    <div><span class="menu-icon">ğŸ“</span> íŒŒì‚°/ì¶”ì‹¬ ì„¼í„°</div>
                    <span class="menu-arrow">â–¼</span>
                </div>
                <ul id="groupSpecial" class="submenu">
                    <li><a href="admin_collection_consult.html">ğŸ’° ì±„ê¶Œ ì¶”ì‹¬ ìƒë‹´</a></li>
                    <li><a href="admin_collection.html">ğŸ’° ì±„ê¶Œ ì¶”ì‹¬ ì‚¬ê±´</a></li>
                    <li><a href="admin_pasan_consult.html">ğŸ“‰ íŒŒì‚°/íšŒìƒ ìƒë‹´</a></li>
                    <li><a href="admin_pasan.html">ğŸ“‰ íŒŒì‚°/íšŒìƒ ì‚¬ê±´</a></li>
                </ul>
            </li>

            <li class="menu-divider"></li>

            <li><a href="admin_settings.html" class="menu-link">âš™ï¸ í™˜ê²½ ì„¤ì •</a></li>
            <li class="menu-divider"></li>
            <li><a href="../../index.html" class="menu-link">ğŸ¢ ê¸°ì—…ìë¬¸ í™ˆí˜ì´ì§€</a></li>
            <li><a href="../user/dashboard.html" class="menu-link" style="color:#2c5bf2; font-weight:700;">ğŸ–¥ï¸ ê¸°ì—…ìë¬¸ ì‚¬ìš©ì ëª¨ë“œ</a></li>
        </ul>
    </nav>

    <script>
        function toggleAdminMenu(id, header) {
            const submenu = document.getElementById(id);
            if(!submenu) return;
            if (submenu.style.display === "block") { submenu.style.display = "none"; header.classList.remove("open"); header.classList.remove("active"); }
            else { submenu.style.display = "block"; header.classList.add("open"); header.classList.add("active"); }
        }
    </script>

    <main class="main-content">
        <h2 style="font-size: 24px; font-weight: 800; margin-bottom: 20px;">Biz Soda ìš”ì²­ ì²˜ë¦¬</h2>

        <div class="stats-container">
            <div class="stat-card">
                <div><div class="stat-title">Biz (ê¸°ì—…) ì‹ ê·œ</div><div class="stat-value" id="count-biz">0</div></div>
                <div class="stat-icon">ğŸ¢</div>
            </div>
            <div class="stat-card">
                <div><div class="stat-title">CEO (ê°œì¸) ì‹ ê·œ</div><div class="stat-value" id="count-ceo">0</div></div>
                <div class="stat-icon">ğŸ‘¤</div>
            </div>
            <div class="stat-card" style="border-left: 5px solid #d46b08;">
                <div><div class="stat-title">Legal (ì¶”ì‹¬) ì‹¬ì‚¬ëŒ€ê¸°</div><div class="stat-value" id="count-legal" style="color:#d46b08;">0</div></div>
                <div class="stat-icon">âš–ï¸</div>
            </div>
        </div>

        <div class="admin-tabs">
            <button class="tab-btn active" onclick="loadRequests('BIZ', this)">ğŸ¢ Biz ìš”ì²­</button>
            <button class="tab-btn" onclick="loadRequests('CEO', this)">ğŸ‘¤ CEO ìš”ì²­</button>
            <button class="tab-btn legal" onclick="loadRequests('LEGAL', this)">âš–ï¸ Legal ì‹¬ì‚¬/ê´€ë¦¬</button>
        </div>

        <div class="table-box">
            <table>
                <thead>
                    <tr id="table-head"></tr>
                </thead>
                <tbody id="request-list">
                    <tr><td colspan="6" align="center" style="padding: 30px;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>
                </tbody>
            </table>
        </div>
    </main>

    <div id="modal-general" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ“„ ì¡°íšŒ ê²°ê³¼ ë“±ë¡ (Report Upload)</h3>
                <button onclick="closeModal('modal-general')" style="border:none; background:none; cursor:pointer; font-size:18px;">âœ•</button>
            </div>
            <p id="target-info" style="color:#666; margin-bottom:20px;">ëŒ€ìƒ: (ì£¼)í˜„ì¼í…Œí¬ (123-45-67890)</p>

            <input type="hidden" id="gen-docId">

            <label class="form-label">ê´€ë¦¬ì ì½”ë©˜íŠ¸ (ì„ íƒ)</label>
            <textarea id="gen-comment" class="form-textarea" placeholder="íŠ¹ì´ì‚¬í•­ ì…ë ¥"></textarea>

            <label class="form-label">ê²°ê³¼ ë³´ê³ ì„œ URL</label>
            <input type="text" id="gen-url" class="form-input" placeholder="ì—…ë¡œë“œëœ íŒŒì¼ URL ë˜ëŠ” ì™¸ë¶€ ë§í¬">

            <button class="btn-primary" style="width:100%; margin-top:20px; padding:12px; font-size:16px;" onclick="saveGeneralResult()">ê²°ê³¼ ì „ì†¡ ë° ì™„ë£Œ ì²˜ë¦¬</button>
        </div>
    </div>

    <div id="modal-legal" class="modal-overlay">
        <div class="modal-box" style="width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title" style="color:#d46b08;">âš–ï¸ Legal Asset ì‹¬ì‚¬ ë° ê²°ê³¼ ì…ë ¥</h3>
                <button onclick="closeModal('modal-legal')" style="border:none; background:none; cursor:pointer; font-size:18px;">âœ•</button>
            </div>

            <input type="hidden" id="leg-docId">

            <div style="background:#fff7e6; padding:15px; border-radius:6px; margin-bottom:20px; border:1px solid #ffd591;">
                <h4 style="font-size:14px; margin-bottom:10px; color:#d46b08;">ğŸ“‚ ì¦ë¹™ ì„œë¥˜ í™•ì¸ (ì‹¬ì‚¬)</h4>
                <div style="display:flex; gap:10px;">
                    <a href="#" id="link-title" target="_blank" class="btn-action">ğŸ“„ ì§‘í–‰ê¶Œì› ë³´ê¸°</a>
                    <a href="#" id="link-notice" target="_blank" class="btn-action">ğŸ“¨ ì‚¬ì „í†µë³´ ì¦ë¹™ ë³´ê¸°</a>
                </div>
            </div>

            <h4 style="font-size:14px; margin-bottom:10px;">âœï¸ ì •ë°€ ì¬ì‚°ì¡°íšŒ ê²°ê³¼ ì…ë ¥</h4>

            <label class="form-label">ì£¼ê±°ë˜ ì€í–‰ ë° ê³„ì¢Œ ë‚´ì—­</label>
            <textarea id="leg-bank" class="form-textarea" placeholder="ì˜ˆ: êµ­ë¯¼ì€í–‰ (123-****-****) / ì”ì•¡ ì¶”ì • ë¶ˆê°€ ë“±"></textarea>

            <label class="form-label">ì‹ ìš©/ì²´í¬ì¹´ë“œ ë°œê¸‰ ë‚´ì—­</label>
            <textarea id="leg-card" class="form-textarea" placeholder="í˜„ëŒ€ì¹´ë“œ(2023.01 ë°œê¸‰), ì‹ í•œì¹´ë“œ..."></textarea>

            <label class="form-label">ê¸°íƒ€ ìì‚° (ë¶€ë™ì‚°/ì°¨ëŸ‰ ë“±)</label>
            <textarea id="leg-asset" class="form-textarea" style="height:60px;" placeholder="ë¶€ë™ì‚° ì†Œìœ  ì´ë ¥ ë“±"></textarea>

            <label class="form-label">ê²°ê³¼ ìš”ì•½ ë³´ê³ ì„œ URL</label>
            <input type="text" id="leg-url" class="form-input" placeholder="ì—…ë¡œë“œëœ íŒŒì¼ URL">

            <div style="display:flex; gap:10px; margin-top:25px;">
                <button class="btn-action" style="flex:1; border-color:#d63384; color:#d63384;" onclick="rejectLegal()">ë°˜ë ¤ (ì¦ë¹™ ë¯¸ë¹„)</button>
                <button class="btn-primary" style="flex:2; background:#d46b08;" onclick="saveLegalResult()">ìŠ¹ì¸ ë° ê²°ê³¼ ì „ì†¡</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { auth, users, bizSoda } from '../../js/api.js';

        let currentType = 'BIZ';
        let selectedDocId = null;

        // ë¡œê·¸ì¸ í™•ì¸
        const token = localStorage.getItem('token');
        if (!token) {
            location.href = '../public/login.html';
        }

        // ê¶Œí•œ í™•ì¸ ë° ë°ì´í„° ë¡œë“œ
        (async () => {
            try {
                const userData = await users.getMe();
                const adminRoles = ['master', 'admin', 'lawyer'];
                if (!adminRoles.includes(userData.role)) {
                    alert('ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
                    location.href = '../user/dashboard.html';
                    return;
                }

                updateStats();
                loadRequests('BIZ');
            } catch (error) {
                console.error('ê¶Œí•œ í™•ì¸ ì—ëŸ¬:', error);
                alert('ë¡œê·¸ì¸ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                location.href = '../public/login.html';
            }
        })();

        // í†µê³„ ì—…ë°ì´íŠ¸
        async function updateStats() {
            try {
                const stats = await bizSoda.getStats();
                document.getElementById('count-biz').innerText = stats.biz || 0;
                document.getElementById('count-ceo').innerText = stats.ceo || 0;
                document.getElementById('count-legal').innerText = stats.legal || 0;
            } catch (error) {
                console.error('í†µê³„ ì¡°íšŒ ì—ëŸ¬:', error);
            }
        }

        // ë¦¬ìŠ¤íŠ¸ ë¡œë”©
        window.loadRequests = async (type, btnEl) => {
            currentType = type;
            if(btnEl) {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                btnEl.classList.add('active');
            }

            const thead = document.getElementById('table-head');
            const tbody = document.getElementById('request-list');
            tbody.innerHTML = '<tr><td colspan="6" align="center">ë¡œë”©ì¤‘...</td></tr>';

            // í—¤ë” ì„¤ì •
            let colName = type === 'LEGAL' ? 'ì±„ë¬´ì(ëŒ€ìƒ)' : 'ëŒ€ìƒ ê¸°ì—…/ê°œì¸';
            let colId = type === 'LEGAL' ? 'ì£¼ë¯¼ë²ˆí˜¸/ì‹ë³„' : 'ì‚¬ì—…ì/ì—°ë½ì²˜';

            thead.innerHTML = `
                <th width="15%">ìš”ì²­ì¼ì‹œ</th>
                <th width="10%">ì‹ ì²­ì</th>
                <th width="20%">${colName}</th>
                <th width="20%">${colId}</th>
                <th width="10%">ìƒíƒœ</th>
                <th width="15%">ê´€ë¦¬</th>
            `;

            try {
                let requests = [];

                if (type === 'LEGAL') {
                    const data = await bizSoda.getLegalRequests();
                    requests = data.requests || [];
                } else {
                    const data = await bizSoda.getRequests({ type });
                    requests = data.requests || [];
                }

                tbody.innerHTML = '';

                if(requests.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" align="center" style="padding:30px;">ìš”ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                    return;
                }

                requests.forEach(d => {
                    const date = d.createdAt ? new Date(d.createdAt).toLocaleString() : '-';

                    // ë±ƒì§€ ìƒíƒœ
                    let statusBadge = `<span class="badge st-pending">ëŒ€ê¸°ì¤‘</span>`;
                    if(d.status === 'done' || d.status === 'approved') statusBadge = `<span class="badge st-done">ì™„ë£Œ</span>`;
                    else if(d.status === 'reviewing') statusBadge = `<span class="badge st-review">ì‹¬ì‚¬ëŒ€ê¸°</span>`;
                    else if(d.status === 'rejected') statusBadge = `<span class="badge st-rejected">ë°˜ë ¤ë¨</span>`;

                    // ë²„íŠ¼
                    let btnHtml = '';
                    if(d.status !== 'done' && d.status !== 'approved' && d.status !== 'rejected') {
                        if(type === 'LEGAL') {
                            const urlTitle = d.fileTitleUrl || '#';
                            const urlNotice = d.fileNoticeUrl || '#';
                            btnHtml = `<button class="btn-primary btn-action" onclick="openLegalModal('${d.docId}', '${d.targetName}', '${urlTitle}', '${urlNotice}')">ì‹¬ì‚¬/ì…ë ¥</button>`;
                        } else {
                            btnHtml = `<button class="btn-primary btn-action" onclick="openGeneralModal('${d.docId}', '${d.targetName}', '${d.targetId}')">ê²°ê³¼ë“±ë¡</button>`;
                        }
                    } else {
                        btnHtml = `<span style="color:#aaa; font-size:12px;">ì²˜ë¦¬ì™„ë£Œ</span>`;
                    }

                    tbody.innerHTML += `
                        <tr>
                            <td>${date}</td>
                            <td>${d.requesterName || 'Admin'}</td>
                            <td style="font-weight:bold;">${d.targetName}</td>
                            <td>${d.targetId}</td>
                            <td>${statusBadge}</td>
                            <td>${btnHtml}</td>
                        </tr>
                    `;
                });
            } catch (error) {
                console.error('ìš”ì²­ ëª©ë¡ ì¡°íšŒ ì—ëŸ¬:', error);
                tbody.innerHTML = '<tr><td colspan="6" align="center" style="color:red; padding:30px;">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</td></tr>';
            }
        };

        // ëª¨ë‹¬ ì—´ê¸° (General)
        window.openGeneralModal = (id, name, info) => {
            selectedDocId = id;
            document.getElementById('gen-docId').value = id;
            document.getElementById('target-info').innerText = `ëŒ€ìƒ: ${name} (${info})`;
            document.getElementById('gen-comment').value = '';
            document.getElementById('gen-url').value = '';
            document.getElementById('modal-general').style.display = 'flex';
        };

        // ëª¨ë‹¬ ì—´ê¸° (Legal)
        window.openLegalModal = (id, name, urlT, urlN) => {
            selectedDocId = id;
            document.getElementById('leg-docId').value = id;
            document.getElementById('link-title').href = urlT;
            document.getElementById('link-notice').href = urlN;
            document.getElementById('leg-bank').value = '';
            document.getElementById('leg-card').value = '';
            document.getElementById('leg-asset').value = '';
            document.getElementById('leg-url').value = '';

            document.getElementById('modal-legal').style.display = 'flex';
        };

        window.closeModal = (id) => {
            document.getElementById(id).style.display = 'none';
        };

        // ê²°ê³¼ ì €ì¥ (Biz/CEO)
        window.saveGeneralResult = async () => {
            if(!confirm("ê²°ê³¼ë¥¼ ë“±ë¡í•˜ê³  ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

            const docId = document.getElementById('gen-docId').value;
            const url = document.getElementById('gen-url').value;
            const comment = document.getElementById('gen-comment').value;

            if (!url) return alert("ê²°ê³¼ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

            try {
                await bizSoda.submitResult(docId, {
                    resultUrl: url,
                    adminComment: comment
                });

                alert("ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
                closeModal('modal-general');
                loadRequests(currentType);
                updateStats();
            } catch(e) {
                console.error(e);
                alert("ì˜¤ë¥˜: " + (e.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
            }
        };

        // ê²°ê³¼ ì €ì¥ (Legal)
        window.saveLegalResult = async () => {
            if(!confirm("ìŠ¹ì¸ ë° ê²°ê³¼ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

            const docId = document.getElementById('leg-docId').value;
            const bankInfo = document.getElementById('leg-bank').value;
            const cardInfo = document.getElementById('leg-card').value;
            const assetInfo = document.getElementById('leg-asset').value;
            const resultUrl = document.getElementById('leg-url').value;

            try {
                await bizSoda.approveLegal(docId, {
                    bankInfo,
                    cardInfo,
                    assetInfo,
                    resultUrl
                });

                alert("ìŠ¹ì¸ ë° ê²°ê³¼ ì…ë ¥ ì™„ë£Œ.");
                closeModal('modal-legal');
                loadRequests('LEGAL');
                updateStats();
            } catch(e) {
                console.error(e);
                alert("ì˜¤ë¥˜: " + (e.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
            }
        };

        window.rejectLegal = async () => {
            const reason = prompt("ë°˜ë ¤ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
            if(!reason) return;

            const docId = document.getElementById('leg-docId').value;

            try {
                await bizSoda.rejectLegal(docId, reason);
                alert("ë°˜ë ¤ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
                closeModal('modal-legal');
                loadRequests('LEGAL');
                updateStats();
            } catch(e) {
                console.error(e);
                alert("ì˜¤ë¥˜: " + (e.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
            }
        };
    </script>
</body>
</html>
