<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>직원 ?�괄 ?�록 (줄�? 분석) - ADMIN</title>
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
    <script src="/js/admin_sidebar.js"></script>
    <style>
        * { box-sizing: border-box; font-family: "Pretendard", sans-serif; }
        body { background: #f5f7fa; color: #333; display: flex; }
        
        .main-content { flex: 1; margin-left: 260px; padding: 40px; }
        .page-header { margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 15px; }
        h2 { margin: 0; color: #1a1a2e; }

        .upload-container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); max-width: 1000px; margin: 0 auto; }
        
        .target-company-box { background: #f0f7ff; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #cce5ff; }
        .search-input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; }
        .auto-list { position: absolute; background: white; border: 1px solid #ddd; width: 100%; max-height: 200px; overflow-y: auto; z-index: 10; display: none; }
        .auto-item { padding: 10px; cursor: pointer; border-bottom: 1px solid #eee; }
        .auto-item:hover { background: #f5f5f5; }

        textarea { width: 100%; height: 250px; padding: 15px; border: 1px solid #ccc; border-radius: 6px; font-size: 13px; line-height: 1.6; resize: vertical; margin-bottom: 15px; }
        textarea:focus { border-color: #2c5bf2; outline: none; background: #f9fbfd; }

        .guide-text { font-size: 13px; color: #666; background: #eee; padding: 15px; border-radius: 6px; margin-bottom: 15px; }
        
        .btn-group { display: flex; gap: 10px; }
        button { flex: 1; padding: 15px; font-size: 16px; font-weight: 700; border-radius: 8px; cursor: pointer; border: none; transition: 0.2s; }
        .btn-analyze { background: #555; color: white; }
        .btn-analyze:hover { background: #333; }
        .btn-upload { background: #2c5bf2; color: white; display: none; }
        .btn-upload:hover { background: #1b42c4; }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 13px; }
        th { background: #f1f3f5; padding: 10px; border: 1px solid #ddd; text-align: left; }
        td { padding: 10px; border: 1px solid #ddd; }
        
        .status-log { margin-top: 20px; padding: 15px; background: #222; color: #0f0; font-family: monospace; height: 150px; overflow-y: auto; display: none; border-radius: 6px; }
    </style>
</head>
<body>

<script>renderAdminSidebar();</script>

<main class="main-content">
    <div class="page-header">
        <h2>?�� 직원 ?�괄 ?�록 (줄�? ?�동 분석)</h2>
    </div>

    <div class="upload-container">
        <div class="target-company-box">
            <h4 style="margin:0 0 10px 0; color:#096dd9;">1. ?�??기업 ?�택 (?�수)</h4>
            <div style="position:relative;">
                <input type="text" id="targetCompInput" class="search-input" placeholder="기업�?검??.." onkeyup="searchCompany(this.value)">
                <div id="compList" class="auto-list"></div>
            </div>
            <div id="selectedCompInfo" style="margin-top:10px; font-weight:bold; color:#2c5bf2; display:none;">
                ?�택?? <span id="selCompName"></span> (<span id="selBizNum"></span>)
            </div>
            <input type="hidden" id="selCompId">
        </div>

        <div class="guide-text">
            <strong>?�� ?�용 방법:</strong><br>
            ?�메?? 카톡, ?��??�서 복사??직원 명단???�래??붙여?�으?�요.<br>
            <strong>[?�수]</strong> ?�메?? ?�름 <br>
            <strong>[?�택]</strong> 부?? 직급, ?�화번호 (?�동 ?�식)<br>
            * ?�메?�이 ?�으�??�록?��? ?�습?�다. 초기 비�?번호??<strong>123456</strong> ?�니??
        </div>

        <textarea id="pasteArea" placeholder="[?�시]
?�길??hong@test.com ?�사?� 010-1234-5678
김철수 cheol@test.com ?�업?� 과장
?�영??young@test.com (?�화번호 ?�음)"></textarea>

        <div class="btn-group">
            <button class="btn-analyze" onclick="analyzeText()">?�이??분석 �?미리보기</button>
            <button class="btn-upload" id="uploadBtn" onclick="startUpload()">DB ?�괄 ?�록 ?�작</button>
        </div>

        <div id="statusLog" class="status-log"></div>
        <div id="previewResult"></div>
    </div>
</main>

<script type="module">
        import { auth, users, requireAuth, checkRole, posts, reports, payments, litigationCases, cases, leaveRequests, creditReports, expenses } from '/js/api.js';
        
        (async () => {
            if (!requireAuth()) return;
            const user = auth.getCurrentUser();
            if (!user) {
                location.href = "/pages/public/login.html";
                return;
            }

            try {
                const userData = await users.getMe();
                
                if (!checkRole(['master', 'admin', 'general_manager'])) {
                    location.href = '/pages/user/dashboard.html';
                    return;
                }
                console.log('Staff upload page loaded');
            } catch (error) {
                console.error('?�이지 로드 ?�러:', error);
                alert('?�이?��? 불러?�는 �??�류가 발생?�습?�다.');
            }
        })();
        
        window.handleLogout = async function() {
            try {
                await auth.logout();
                location.href = "/";
            } catch (error) {
                console.error('로그?�웃 ?�러:', error);
            }
        };
    </script>

</body>
</html>
