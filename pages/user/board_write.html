<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìë¬¸ ì‹ ì²­í•˜ê¸° - ë²•ë¬´ê·¸ë£¹ í˜„ì¼</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <style>
        /* [ìŠ¤íƒ€ì¼ ìœ ì§€] */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Pretendard Variable", Pretendard, sans-serif; }
        body { background-color: #f5f7fa; color: #333; display: flex; min-height: 100vh; }
        a { text-decoration: none; color: inherit; }
        ul, li { list-style: none; }
        input, textarea, select { font-family: inherit; }

        /* [ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ - client_ui.js ëŒ€ì‘] */
        .sidebar { width: 260px; background-color: #fff; border-right: 1px solid #eee; padding: 40px 20px; display: flex; flex-direction: column; position: fixed; height: 100vh; left: 0; top: 0; z-index: 100; }
        .sidebar-logo { margin-bottom: 30px; padding-left: 10px; }
        .sidebar-logo img { height: 32px; }
        
        .user-profile-area { background: #f9f9f9; padding: 20px; border-radius: 12px; margin-bottom: 30px; border: 1px solid #eee; }
        .user-name { font-size: 16px; font-weight: 800; color: #1a1a1a; margin-bottom: 4px; }
        .user-email { font-size: 12px; color: #888; margin-bottom: 10px; word-break: break-all; }
        .user-role { display: inline-block; font-size: 11px; padding: 3px 8px; border-radius: 4px; font-weight: 700; }
        .badge-owner { background: #1a1a2e; color: #fff; }
        .badge-manager { background: #e6f7ff; color: #096dd9; }
        .badge-staff { background: #f0f0f0; color: #555; }

        .menu-list li { margin-bottom: 8px; }
        .menu-link { display: block; padding: 14px 15px; border-radius: 8px; color: #555; font-weight: 500; transition: 0.2s; font-size: 15px; }
        .menu-link:hover { background-color: #f0f0f0; color: #1a1a1a; }
        .menu-link.active { background-color: #1a1a1a; color: #fff; font-weight: 700; }
        .logout-btn { margin-top: auto; padding: 15px 20px; color: #999; font-size: 14px; cursor: pointer; }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-content { flex: 1; margin-left: 260px; padding: 60px 50px; }
        .page-header { margin-bottom: 30px; border-bottom: 1px solid #ddd; padding-bottom: 20px; display: flex; justify-content: space-between; align-items: flex-end; }
        .page-title { font-size: 24px; font-weight: 700; color: #1a1a1a; }

        .write-container { background: #fff; padding: 40px; border-radius: 12px; border: 1px solid #eee; max-width: 800px; box-shadow: 0 4px 20px rgba(0,0,0,0.02); }
        .form-group { margin-bottom: 24px; }
        .label { display: block; font-weight: 700; margin-bottom: 8px; font-size: 15px; color: #333; }
        .input-box { width: 100%; height: 48px; border: 1px solid #ddd; border-radius: 6px; padding: 0 15px; font-size: 15px; outline: none; transition: 0.2s; background: #fff; }
        .input-box:focus { border-color: #1a1a1a; }
        .textarea-box { height: 300px; padding: 15px; resize: none; line-height: 1.6; }

        .file-upload-box { border: 1px dashed #ddd; padding: 20px; border-radius: 6px; background-color: #fafafa; text-align: center; }
        .file-input { display: none; }
        .file-label { cursor: pointer; display: inline-block; padding: 8px 16px; background-color: #fff; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; font-weight: 600; color: #555; }
        .file-name { margin-left: 10px; font-size: 13px; color: #2c5bf2; }

        .usage-area { display: flex; justify-content: flex-end; align-items: center; margin-bottom: 10px; gap: 8px; }
        .usage-badge { background-color: #e6f7ff; color: #096dd9; padding: 6px 12px; border-radius: 6px; font-size: 13px; font-weight: 700; border: 1px solid #91d5ff; }
        .usage-full { background-color: #fff1f0; color: #cf1322; border-color: #ffa39e; }

        .btn-submit { background-color: #1a1a1a; color: #fff; border: none; padding: 15px 0; border-radius: 6px; font-weight: 700; font-size: 16px; cursor: pointer; width: 100%; transition: 0.2s; }
        .btn-submit:hover { background-color: #333; }
        .btn-submit:disabled { background-color: #ccc !important; cursor: not-allowed; color: #666; }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 30px 20px; }
            .page-header { flex-direction: column; align-items: flex-start; gap: 10px; }
        }
    </style>
</head>
<body>

    
    <!-- Sidebar Skeleton (ê¹œë¹¡ì„ ë°©ì§€) -->
    <nav class="sidebar">
        <div class="sidebar-logo">
            <a href="../../index.html"><img src="../../assets/img/logo.png" alt="ë²•ë¬´ê·¸ë£¹ í˜„ì¼"></a>
        </div>
        <div class="user-profile-area">
            <div class="user-name">ë¡œë”©ì¤‘...</div>
            <div class="user-email">...</div>
            <div class="user-role badge-staff">...</div>
        </div>
        <ul class="menu-list">
            <li><a href="../../pages/user/dashboard.html" class="menu-link">ëŒ€ì‹œë³´ë“œ</a></li>
            <li><a href="../../pages/user/board_list.html" class="menu-link">ë‚˜ì˜ ìë¬¸ ë‚´ì—­</a></li>
            <li><a href="../../pages/user/payment.html" class="menu-link">ê²°ì œ/êµ¬ë… ê´€ë¦¬</a></li>
            <li><a href="../../pages/user/member_info.html" class="menu-link">íšŒì› ì •ë³´ ìˆ˜ì •</a></li>
            <li><a href="../../pages/public/user_guide.html" class="menu-link">ğŸ“˜ ì´ìš© ê°€ì´ë“œ (FAQ)</a></li>
        </ul>
        <div class="logout-btn" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</div>
    </nav>

<main class="main-content">
        <div class="page-header">
            <div>
                <h2 class="page-title">âœï¸ ìë¬¸ ì‹ ì²­í•˜ê¸°</h2>
                <p style="color:#666; font-size:14px; margin-top:5px;">ë²•ë¥  ì „ë¬¸ê°€ì—ê²Œ ì •í™•í•œ ì†”ë£¨ì…˜ì„ ë°›ì•„ë³´ì„¸ìš”.</p>
            </div>
        </div>

        <div class="write-container">
            <div class="form-group">
                <label class="label">ìƒë‹´ ë¶„ì•¼</label>
                <select id="category" class="input-box">
                    <option value="contract">ê³„ì•½ ê²€í† </option>
                    <option value="labor">ë…¸ë¬´/ì¸ì‚¬</option>
                    <option value="debt">ì±„ê¶Œ/ë¯¸ìˆ˜ê¸ˆ</option>
                    <option value="ip">ì§€ì‹ì¬ì‚°ê¶Œ</option>
                    <option value="etc">ê¸°íƒ€ ìë¬¸</option>
                </select>
            </div>

            <div class="form-group">
                <label class="label">ì‘ì„± ë¶€ì„œ</label>
                <select id="department" class="input-box">
                    <option value="">ë¡œë”© ì¤‘...</option>
                </select>
            </div>

            <div class="form-group">
                <label class="label">ì œëª©</label>
                <input type="text" id="title" class="input-box" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>

            <div class="form-group">
                <label class="label">ì²¨ë¶€íŒŒì¼ (10MB ì œí•œ)</label>
                <div class="file-upload-box">
                    <label for="fileInput" class="file-label">íŒŒì¼ ì„ íƒ</label>
                    <input type="file" id="fileInput" class="file-input" onchange="showFileName()">
                    <span id="fileNameDisplay" class="file-name">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</span>
                </div>
                <div style="margin-top:10px; font-size:13px; color:#666;">
                    <input type="checkbox" id="emailSendCheck" style="vertical-align:middle; margin-right:5px;">
                    <label for="emailSendCheck" style="cursor:pointer;">ğŸ“¨ ì²¨ë¶€íŒŒì¼: ë³„ë„ ë©”ì¼ë¡œ ì „ë‹¬ ì‹ ì²­</label>
                    <div style="margin-top:4px; color:#888;">â€» 10MB ì´ìƒ ëŒ€ìš©ëŸ‰ íŒŒì¼ì€ <strong><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="046777446c7d716a6d686865732a676b69">[email&#160;protected]</a></strong>ìœ¼ë¡œ ë°œì†¡ í›„ ì²´í¬í•´ì£¼ì„¸ìš”.</div>
                </div>
            </div>

            <div class="form-group">
                <label class="label">ë¬¸ì˜ ë‚´ìš©</label>
                <textarea id="content" class="input-box textarea-box" placeholder="êµ¬ì²´ì ì¸ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."></textarea>
            </div>

            <div class="usage-area">
                <span style="font-size:13px; color:#666;">ì´ë²ˆ ë‹¬ ì„œë©´ ìë¬¸ í˜„í™©:</span>
                <div id="usageBadge" class="usage-badge">ë¡œë”©ì¤‘...</div>
            </div>

            <button id="btnSubmit" class="btn-submit" onclick="submitPost()">ì‹ ì²­í•˜ê¸° (1íšŒ ì°¨ê°)</button>
        </div>
    </main>

    <script type="module">
        import { auth, users, requireAuth, posts, approvalRequests } from "../../js/api.js";
        import { renderClientSidebar } from "../../js/client_ui.js";

        const PLAN_SPECS = {
            'none': { qa: 0, phone: 0, label: 'ë¯¸ê°€ì…' },
            'Basic': { qa: 1, phone: 0, label: 'ğŸŒ± Basic' },
            'Standard': { qa: 3, phone: 1, label: 'â­ Standard' },
            'Pro': { qa: 5, phone: 2, label: 'ğŸ’ Pro' },
            'Premium': { qa: 8, phone: 5, label: 'ğŸ‘‘ Premium' },
            'Enterprise': { qa: 999, phone: 999, label: 'ğŸ¢ Enterprise' }
        };

        let gUserData = null;

        let uploadedFileUrl = null;

        function updateUsageBadge(userData) {
            const badge = document.getElementById('usageBadge');
            const submitBtn = document.getElementById('btnSubmit');
            if (!badge) return;

            const spec = PLAN_SPECS[userData.plan] || PLAN_SPECS['none'];
            const qaLimit = userData.plan === 'Enterprise' ? (userData.customQaLimit || 0) : spec.qa;
            const qaUsed = userData.qaUsedCount || 0;
            const qaRemaining = Math.max(0, qaLimit - qaUsed);

            if (qaLimit === 0) {
                badge.textContent = 'í”Œëœ ë¯¸ê°€ì…';
                badge.className = 'usage-badge usage-full';
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'í”Œëœì„ êµ¬ë…í•´ì£¼ì„¸ìš”';
                }
            } else if (qaRemaining === 0) {
                badge.textContent = `${qaRemaining} / ${qaLimit} (í•œë„ ì´ˆê³¼)`;
                badge.className = 'usage-badge usage-full';
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'ì‚¬ìš© ê°€ëŠ¥ íšŸìˆ˜ ì´ˆê³¼';
                }
            } else {
                badge.textContent = `${qaRemaining} / ${qaLimit} (ë‚¨ì€ ${qaRemaining}ê±´)`;
                badge.className = 'usage-badge';
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'ì‹ ì²­í•˜ê¸° (1íšŒ ì°¨ê°)';
                }
            }
        }

        window.showFileName = async function() {
            const fileInput = document.getElementById('fileInput');
            const fileNameDisplay = document.getElementById('fileNameDisplay');

            if (fileInput && fileInput.files[0]) {
                const file = fileInput.files[0];

                // íŒŒì¼ í¬ê¸° ì²´í¬ (10MB)
                if (file.size > 10 * 1024 * 1024) {
                    alert('íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    fileInput.value = '';
                    fileNameDisplay.textContent = 'ì„ íƒëœ íŒŒì¼ ì—†ìŒ';
                    return;
                }

                // ì—…ë¡œë“œ ì¤‘ í‘œì‹œ
                fileNameDisplay.textContent = 'ì—…ë¡œë“œ ì¤‘...';
                fileNameDisplay.style.color = '#2c5bf2';

                try {
                    // íŒŒì¼ ì—…ë¡œë“œ
                    const formData = new FormData();
                    formData.append('file', file);

                    const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
                        ? 'http://localhost:3000/api'
                        : 'https://hyunil-law-backend.onrender.com/api';

                    const token = localStorage.getItem('auth_token');
                    const response = await fetch(`${API_BASE_URL}/upload`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`
                        },
                        body: formData
                    });

                    const result = await response.json();

                    // ì—…ë¡œë“œ ì‹¤íŒ¨ (ë°±ì—”ë“œì—ì„œ ì—ëŸ¬ ë°˜í™˜)
                    if (!response.ok || !result.success) {
                        throw new Error(result.message || 'íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨');
                    }

                    // ì—…ë¡œë“œ ì„±ê³µ
                    uploadedFileUrl = result.fileUrl;
                    fileNameDisplay.textContent = `âœ“ ${file.name} (ì—…ë¡œë“œ ì™„ë£Œ)`;
                    fileNameDisplay.style.color = '#52c41a';

                } catch (error) {
                    console.error('íŒŒì¼ ì—…ë¡œë“œ ì—ëŸ¬:', error);
                    alert(error.message);
                    fileInput.value = '';
                    fileNameDisplay.textContent = 'ì„ íƒëœ íŒŒì¼ ì—†ìŒ';
                    fileNameDisplay.style.color = '#999';
                    uploadedFileUrl = null;
                }
            } else if (fileNameDisplay) {
                fileNameDisplay.textContent = 'ì„ íƒëœ íŒŒì¼ ì—†ìŒ';
                fileNameDisplay.style.color = '#999';
                uploadedFileUrl = null;
            }
        };

        (async () => {
            if (!requireAuth()) {
                location.href = "../../pages/public/login.html";
                return;
            }
            
            const user = auth.getCurrentUser();
            if (!user) {
                location.href = "../../pages/public/login.html";
                return;
            }
            
            try {
                gUserData = await users.getMe();
                renderClientSidebar('board_write', gUserData);

                // ë¶€ì„œ ì˜µì…˜ ì„¤ì •
                const departmentSelect = document.getElementById('department');
                if (departmentSelect) {
                    console.log('ì‚¬ìš©ì ë°ì´í„°:', gUserData);
                    console.log('departments ì›ë³¸:', gUserData.departments);
                    console.log('departments íƒ€ì…:', typeof gUserData.departments);

                    let departmentsList = [];

                    // departmentsê°€ ë¬¸ìì—´ì¸ ê²½ìš° JSON íŒŒì‹± ì‹œë„
                    if (typeof gUserData.departments === 'string' && gUserData.departments.trim() !== '') {
                        try {
                            departmentsList = JSON.parse(gUserData.departments);
                            console.log('JSON íŒŒì‹± ì„±ê³µ:', departmentsList);
                        } catch (e) {
                            console.error('JSON íŒŒì‹± ì‹¤íŒ¨:', e);
                            departmentsList = [];
                        }
                    }
                    // departmentsê°€ ì´ë¯¸ ë°°ì—´ì¸ ê²½ìš°
                    else if (Array.isArray(gUserData.departments)) {
                        departmentsList = gUserData.departments;
                    }

                    // departments ë°°ì—´ì´ ìˆìœ¼ë©´ (ì „ì‚¬ ê¶Œí•œ) ëª¨ë“  ë¶€ì„œ í‘œì‹œ
                    if (departmentsList.length > 0) {
                        const options = departmentsList.map(dept => {
                            const selected = dept === gUserData.department ? ' selected' : '';
                            return `<option value="${dept}"${selected}>${dept}</option>`;
                        }).join('');
                        departmentSelect.innerHTML = options;
                        console.log('âœ… ì „ì‚¬ ê¶Œí•œ: ëª¨ë“  ë¶€ì„œ í‘œì‹œ', departmentsList);
                    }
                    // departments ë°°ì—´ì´ ì—†ìœ¼ë©´ ìì‹ ì˜ ë¶€ì„œë§Œ í‘œì‹œ
                    else if (gUserData.department) {
                        departmentSelect.innerHTML = `<option value="${gUserData.department}">${gUserData.department}</option>`;
                        console.log('ì¼ë°˜ ê¶Œí•œ: ë³¸ì¸ ë¶€ì„œë§Œ í‘œì‹œ', gUserData.department);
                    } else {
                        departmentSelect.innerHTML = '<option value="ì¼ë°˜">ì¼ë°˜</option>';
                        console.log('ë¶€ì„œ ì •ë³´ ì—†ìŒ: ê¸°ë³¸ê°’ ì‚¬ìš©');
                    }
                }

                // ì‚¬ìš©ëŸ‰ í‘œì‹œ ë° ë²„íŠ¼ í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
                updateUsageBadge(gUserData);
                updateSubmitButtonText();

                console.log('ìë¬¸ ì‹ ì²­ í˜ì´ì§€ ë¡œë“œ:', gUserData);

            } catch (error) {
                console.error('í˜ì´ì§€ ë¡œë“œ ì—ëŸ¬:', error);
                alert('í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        })();

        window.submitPost = async function() {
            if (!gUserData) {
                alert('ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ì‚¬ìš©ëŸ‰ ì²´í¬
            const spec = PLAN_SPECS[gUserData.plan] || PLAN_SPECS['none'];
            const qaLimit = gUserData.plan === 'Enterprise' ? (gUserData.customQaLimit || 0) : spec.qa;
            const qaUsed = gUserData.qaUsedCount || 0;
            const qaRemaining = Math.max(0, qaLimit - qaUsed);

            if (qaLimit === 0) {
                alert('í”Œëœì„ ë¨¼ì € êµ¬ë…í•´ì£¼ì„¸ìš”.');
                location.href = '../../pages/user/payment.html';
                return;
            }

            if (qaRemaining === 0) {
                alert('ì‚¬ìš© ê°€ëŠ¥í•œ ìë¬¸ íšŸìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.\nê²°ì œ/êµ¬ë… ê´€ë¦¬ í˜ì´ì§€ì—ì„œ ì¶”ê°€ êµ¬ë§¤í•˜ì‹œê±°ë‚˜ í”Œëœì„ ì—…ê·¸ë ˆì´ë“œí•´ì£¼ì„¸ìš”.');
                location.href = '../../pages/user/payment.html';
                return;
            }

            const category = document.getElementById('category')?.value;
            const title = document.getElementById('title')?.value;
            const content = document.getElementById('content')?.value;
            const department = document.getElementById('department')?.value;

            if (!category || !title || !content) {
                alert('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const btn = document.getElementById('btnSubmit');
            if (btn) {
                btn.innerText = 'ì „ì†¡ ì¤‘...';
                btn.disabled = true;
            }

            try {
                const userRole = gUserData.role;
                const fileUrls = uploadedFileUrl ? [uploadedFileUrl] : [];
                
                const postData = {
                    category,
                    title,
                    content,
                    department,
                    fileUrls
                };

                const useApprovalFlow = gUserData.useApproval === 1;
                const isStaff = userRole === 'user' || userRole === 'manager';

                // 'user' ë˜ëŠ” 'manager' ì—­í• ì´ê³  ìŠ¹ì¸ê²°ì¬ ê¸°ëŠ¥ì´ ì¼œì ¸ìˆìœ¼ë©´ ìŠ¹ì¸ ìš”ì²­ ìƒì„±
                if (useApprovalFlow && isStaff) {
                    await approvalRequests.createRequest({
                        requestType: 'ìë¬¸ìš”ì²­',
                        requestData: postData
                    });
                    alert('ìë¬¸ ì‹ ì²­ì´ ëŒ€í‘œ(CEO)ì—ê²Œ ìŠ¹ì¸ ìš”ì²­ë˜ì—ˆìŠµë‹ˆë‹¤.\nìŠ¹ì¸ ì‹œ ìë™ìœ¼ë¡œ ë“±ë¡ë˜ë©°, ì‚¬ìš© ê°€ëŠ¥ íšŸìˆ˜ê°€ ì°¨ê°ë©ë‹ˆë‹¤.');
                    location.href = '../../pages/user/board_list.html';
                } else {
                    // ê·¸ ì™¸ (owner, admin ë˜ëŠ” ìŠ¹ì¸ê²°ì¬ ê¸°ëŠ¥ OFF)ëŠ” ì¦‰ì‹œ ìƒì„±
                    await posts.create(postData);
                    alert('ìë¬¸ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\nì‚¬ìš© ê°€ëŠ¥ íšŸìˆ˜ê°€ 1íšŒ ì°¨ê°ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    location.href = '../../pages/user/board_list.html';
                }

            } catch (error) {
                console.error('ë“±ë¡ ì—ëŸ¬:', error);
                alert('ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                if (btn) {
                    btn.disabled = false;
                    updateSubmitButtonText(); // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³µì›
                }
            }
        };

        window.handleLogout = async () => {
            await auth.logout();
            location.href = '../../index.html';
        };

        // ì œì¶œ ë²„íŠ¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateSubmitButtonText() {
            const btn = document.getElementById('btnSubmit');
            if (!btn || !gUserData) return;

            const useApprovalFlow = gUserData.useApproval === 1;
            const isStaff = gUserData.role === 'user' || gUserData.role === 'manager';

            if (useApprovalFlow && isStaff) {
                btn.textContent = 'ìŠ¹ì¸ ìš”ì²­í•˜ê¸°';
            } else {
                // ì‚¬ìš©ëŸ‰ì— ë”°ë¼ í…ìŠ¤íŠ¸ ë³€ê²½
                const spec = PLAN_SPECS[gUserData.plan] || PLAN_SPECS['none'];
                const qaLimit = gUserData.plan === 'Enterprise' ? (gUserData.customQaLimit || 0) : spec.qa;
                const qaUsed = gUserData.qaUsedCount || 0;
                const qaRemaining = Math.max(0, qaLimit - qaUsed);

                if (qaLimit === 0) {
                    btn.textContent = 'í”Œëœì„ êµ¬ë…í•´ì£¼ì„¸ìš”';
                    btn.disabled = true;
                } else if (qaRemaining === 0) {
                    btn.textContent = 'ì‚¬ìš© ê°€ëŠ¥ íšŸìˆ˜ ì´ˆê³¼';
                    btn.disabled = true;
                } else {
                    btn.textContent = 'ì‹ ì²­í•˜ê¸° (1íšŒ ì°¨ê°)';
                    btn.disabled = false;
                }
            }
        }
    </script>
</body>
</html>
