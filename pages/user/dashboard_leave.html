<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—°ì°¨ ë° íœ´ê°€ ì‹ ì²­ - ë²•ë¬´ê·¸ë£¹ í˜„ì¼ (ì‚¬ìš©ì)</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <style>
        /* [ê¸°ë³¸ ìŠ¤íƒ€ì¼] */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Pretendard Variable", Pretendard, sans-serif; }
        body { background-color: #f5f7fa; color: #333; display: flex; min-height: 100vh; font-size:14px; }
        a { text-decoration: none; color: inherit; }
        ul, li { list-style: none; }
        input, select, textarea { font-family: inherit; }

        /* ì‚¬ì´ë“œë°” (ì‚¬ìš©ì ëª¨ë“œìš©) */
        .sidebar { width: 260px; background-color: #fff; border-right: 1px solid #eee; padding: 30px 20px; display: flex; flex-direction: column; position: fixed; height: 100vh; left: 0; top: 0; z-index: 100; }
        .sidebar-brand { font-size: 20px; font-weight: 800; margin-bottom: 40px; color: #2c5bf2; padding-left: 10px; }
        .sidebar-menu { list-style: none; padding: 0; }
        .menu-item { display: block; padding: 12px 15px; margin-bottom: 5px; border-radius: 8px; color: #555; font-weight: 600; transition: 0.2s; font-size: 15px; }
        .menu-item:hover { background-color: #f0f7ff; color: #2c5bf2; }
        .menu-item.active { background-color: #2c5bf2; color: #fff; }
        .menu-icon { margin-right: 10px; }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-content { flex: 1; margin-left: 260px; padding: 40px; max-width: 1200px; }
        .page-header { margin-bottom: 30px; }
        .page-title { font-size: 24px; font-weight: 700; color: #1a1a1a; margin-bottom: 10px; }
        .page-sub { color: #666; font-size: 14px; }

        /* ì—°ì°¨ ìš”ì•½ ì¹´ë“œ */
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 40px; }
        .stat-card { background: #fff; padding: 25px; border-radius: 12px; border: 1px solid #e5e5e5; box-shadow: 0 2px 10px rgba(0,0,0,0.02); text-align: center; }
        .sc-label { font-size: 14px; color: #888; font-weight: 600; margin-bottom: 10px; }
        .sc-val { font-size: 32px; font-weight: 800; color: #333; }
        .text-total { color: #333; }
        .text-used { color: #ff4d4f; }
        .text-remain { color: #2c5bf2; }

        /* ì‹ ì²­ í¼ & ë¦¬ìŠ¤íŠ¸ ë ˆì´ì•„ì›ƒ */
        .content-layout { display: grid; grid-template-columns: 1fr 1.5fr; gap: 30px; }
        
        .section-box { background: #fff; padding: 30px; border-radius: 12px; border: 1px solid #e5e5e5; }
        .box-title { font-size: 18px; font-weight: 700; margin-bottom: 20px; border-bottom: 2px solid #333; padding-bottom: 15px; }

        /* í¼ ìŠ¤íƒ€ì¼ */
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-weight: 700; margin-bottom: 8px; color: #555; }
        .input-box { width: 100%; height: 46px; border: 1px solid #ddd; border-radius: 8px; padding: 0 15px; font-size: 15px; outline: none; transition: 0.2s; }
        .input-box:focus { border-color: #2c5bf2; }
        .input-area { width: 100%; height: 100px; border: 1px solid #ddd; border-radius: 8px; padding: 15px; font-size: 15px; resize: none; outline: none; }
        
        .btn-submit { width: 100%; height: 50px; background-color: #2c5bf2; color: #fff; border: none; border-radius: 8px; font-size: 16px; font-weight: 700; cursor: pointer; transition: 0.2s; margin-top: 10px; }
        .btn-submit:hover { background-color: #1b44c9; }

        /* ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .history-list { list-style: none; padding: 0; }
        .history-item { padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .history-item:last-child { border-bottom: none; }
        
        .h-info { flex: 1; }
        .h-date { font-size: 16px; font-weight: 700; color: #333; margin-bottom: 5px; }
        .h-type { font-size: 13px; color: #666; background: #f5f5f5; padding: 4px 8px; border-radius: 4px; margin-right: 5px; }
        .h-reason { font-size: 13px; color: #888; }
        
        .status-badge { padding: 6px 12px; border-radius: 20px; font-size: 13px; font-weight: 700; }
        .st-pending { background: #fff7e6; color: #d46b08; border: 1px solid #ffd591; }
        .st-approved { background: #f6ffed; color: #52c41a; border: 1px solid #b7eb8f; }
        .st-rejected { background: #fff1f0; color: #ff4d4f; border: 1px solid #ffa39e; }

        @media (max-width: 1000px) { .content-layout { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<nav class="sidebar">
    <div class="sidebar-brand">ë²•ë¬´ê·¸ë£¹ í˜„ì¼</div>
    <ul class="sidebar-menu">
        <li><a href="../../pages/user/dashboard.html" class="menu-item"><span class="menu-icon">ğŸ </span> í™ˆ / ëŒ€ì‹œë³´ë“œ</a></li>
        <li><a href="dashboard_request.html" class="menu-item"><span class="menu-icon">ğŸ“</span> ìë¬¸ ìš”ì²­í•˜ê¸°</a></li>
        <li><a href="dashboard_cases.html" class="menu-item"><span class="menu-icon">ğŸ“‚</span> ë‚´ ì‚¬ê±´ í˜„í™©</a></li>
        <li><a href="../../pages/user/dashboard_leave.html" class="menu-item active"><span class="menu-icon">ğŸ–ï¸</span> ì—°ì°¨/íœ´ê°€ ì‹ ì²­</a></li> <li><a href="dashboard_settings.html" class="menu-item"><span class="menu-icon">âš™ï¸</span> ë‚´ ì •ë³´ ì„¤ì •</a></li>
    </ul>
</nav>

<main class="main-content">
    <div class="page-header">
        <h2 class="page-title">ì—°ì°¨ ë° íœ´ê°€ ê´€ë¦¬</h2>
        <div class="page-sub">ì”ì—¬ ì—°ì°¨ë¥¼ í™•ì¸í•˜ê³  íœ´ê°€ë¥¼ ì‹ ì²­í•˜ì„¸ìš”.</div>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="sc-label">ì´ ì—°ì°¨ (Total)</div>
            <div class="sc-val text-total" id="statTotal">0</div>
        </div>
        <div class="stat-card">
            <div class="sc-label">ì‚¬ìš© ì¼ìˆ˜ (Used)</div>
            <div class="sc-val text-used" id="statUsed">0</div>
        </div>
        <div class="stat-card">
            <div class="sc-label">ì”ì—¬ ì¼ìˆ˜ (Remaining)</div>
            <div class="sc-val text-remain" id="statRemain">0</div>
        </div>
    </div>

    <div class="content-layout">
        <div class="section-box">
            <div class="box-title">âœˆï¸ íœ´ê°€ ì‹ ì²­í•˜ê¸°</div>
            
            <div class="form-group">
                <label class="form-label">íœ´ê°€ êµ¬ë¶„</label>
                <select id="leaveType" class="input-box">
                    <option value="1">ì—°ì°¨ (1ì¼)</option>
                    <option value="0.5_am">ë°˜ì°¨ (ì˜¤ì „)</option>
                    <option value="0.5_pm">ë°˜ì°¨ (ì˜¤í›„)</option>
                    <option value="sick">ë³‘ê°€</option>
                    <option value="event">ê²½ì¡°ì‚¬</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">ì‹œì‘ì¼</label>
                <input type="date" id="startDate" class="input-box" onchange="calcDays()">
            </div>

            <div class="form-group">
                <label class="form-label">ì¢…ë£Œì¼</label>
                <input type="date" id="endDate" class="input-box" onchange="calcDays()">
            </div>
            
            <div class="form-group">
                <label class="form-label">ì˜ˆìƒ ì‚¬ìš©ì¼ìˆ˜</label>
                <input type="text" id="calcDays" class="input-box" value="0ì¼" readonly style="background:#f9f9f9; color:#2c5bf2; font-weight:bold;">
            </div>

            <div class="form-group">
                <label class="form-label">ì‹ ì²­ ì‚¬ìœ </label>
                <textarea id="leaveReason" class="input-area" placeholder="ì˜ˆ: ê°œì¸ ì‚¬ì •ìœ¼ë¡œ ì¸í•œ ì—°ì°¨ ì‚¬ìš©"></textarea>
            </div>

            <button class="btn-submit" onclick="submitLeave()">ì‹ ì²­í•˜ê¸°</button>
        </div>

        <div class="section-box">
            <div class="box-title">ğŸ“œ ì‹ ì²­ ë‚´ì—­ (ìµœê·¼ìˆœ)</div>
            <ul id="historyList" class="history-list">
                <li style="text-align:center; padding:30px; color:#999;">ë¡œë”© ì¤‘...</li>
            </ul>
        </div>
    </div>
</main>

    <script type="module">
        import { auth, users, requireAuth, leaveRequests } from "../../js/api.js";
        import { renderClientSidebar } from "../../js/client_ui.js";

        (async () => {
            if (!requireAuth()) {
                location.href = "/pages/public/login.html";
                return;
            }

            const user = auth.getCurrentUser();
            if (!user) {
                location.href = "/pages/public/login.html";
                return;
            }

            try {
                const userData = await users.getMe();
                renderClientSidebar('dashboard_leave', userData);

                const requests = await leaveRequests.getAll();
                console.log('íœ´ê°€ ì‹ ì²­ ë‚´ì—­:', requests);

            } catch (error) {
                console.error('íœ´ê°€ ë‚´ì—­ ë¡œë“œ ì—ëŸ¬:', error);
            }
        })();

        window.handleLogout = async () => {
            await auth.logout();
            location.href = "/";
        };
    </script>
</body>
</html>
