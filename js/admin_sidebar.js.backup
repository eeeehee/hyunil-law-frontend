// [admin_sidebar.js] - v3.2 (ìš”êµ¬ì‚¬í•­ ë°˜ì˜: ìˆœì„œ ì¬ë°°ì¹˜ ë° Biz Soda ë©”ë‰´ ì¶”ê°€)

function renderAdminSidebar() {
    const sidebarStyles = `
        /* (ìŠ¤íƒ€ì¼ì€ ê¸°ì¡´ê³¼ ë™ì¼í•˜ë¯€ë¡œ ìƒëµ - ê·¸ëŒ€ë¡œ ìœ ì§€) */
        .sidebar { width: 260px; background-color: #1a1a2e; color: #fff; display: flex; flex-direction: column; position: fixed; height: 100vh; left: 0; top: 0; z-index: 1000; overflow-y: auto; box-shadow: 2px 0 10px rgba(0,0,0,0.1); font-family: "Pretendard Variable", Pretendard, sans-serif; }
        .sidebar a { text-decoration: none; color: inherit; display: block; }
        .sidebar ul, .sidebar li { list-style: none; padding: 0; margin: 0; }
        .sidebar-brand { font-size: 20px; font-weight: 800; padding: 25px 20px 10px 20px; color: #fff; letter-spacing: 1px; }
        .sidebar-profile { padding: 20px; border-bottom: 1px solid #2c2c45; margin-bottom: 10px; background: rgba(0,0,0,0.1); }
        .profile-info { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
        .profile-avatar { width: 38px; height: 38px; background: #2c5bf2; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
        .profile-text { display: flex; flex-direction: column; overflow: hidden; }
        .profile-name { color: #fff; font-weight: 700; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .profile-email { color: #888; font-size: 11px; margin-top: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .profile-role { font-size: 10px; color: #4dabf7; margin-top: 2px; font-weight: 600; }
        .btn-logout-mini { width: 100%; padding: 8px 0; background: #2c2c45; color: #ccc; border: 1px solid #3a3a5e; border-radius: 4px; font-size: 12px; font-weight: 600; cursor: pointer; transition: 0.2s; text-align: center; }
        .btn-logout-mini:hover { background: #ff4d4f; color: #fff; border-color: #ff4d4f; }
        .sidebar-menu { padding: 10px; }
        .menu-category { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; color: #a6a6b5; font-size: 14px; font-weight: 600; cursor: pointer; border-radius: 8px; margin-bottom: 4px; transition: 0.2s; }
        .menu-category:hover { background-color: rgba(255, 255, 255, 0.05); color: #fff; }
        .menu-category.active { color: #fff; background-color: #2c2c45; }
        .menu-icon { margin-right: 8px; width: 20px; text-align: center; display: inline-block; }
        .submenu { display: none; background-color: rgba(0,0,0,0.2); border-radius: 8px; margin-bottom: 8px; overflow: hidden; }
        .submenu li a { padding: 10px 15px 10px 48px; font-size: 13px; color: #888; transition: 0.2s; }
        .submenu li a:hover { color: #fff; background-color: rgba(255,255,255,0.05); }
        .menu-divider { border-top: 1px solid #2c2c45; margin: 15px 10px; }
        .sidebar::-webkit-scrollbar { width: 6px; }
        .sidebar::-webkit-scrollbar-track { background: #1a1a2e; }
        .sidebar::-webkit-scrollbar-thumb { background: #2c2c45; border-radius: 3px; }
    `;

    if (!document.getElementById('admin-sidebar-css')) {
        const styleEl = document.createElement('style');
        styleEl.id = 'admin-sidebar-css';
        styleEl.innerHTML = sidebarStyles;
        document.head.appendChild(styleEl);
    }

    const sidebarHTML = `
    <nav class="sidebar">
        <div class="sidebar-brand">ADMINISTRATOR</div>
        
        <div class="sidebar-profile">
            <div class="profile-info">
                <div class="profile-avatar">ğŸ‘¤</div>
                <div class="profile-text">
                    <span class="profile-name" id="sb_userName">Guest</span>
                    <span class="profile-email" id="sb_userEmail">ë¡œê·¸ì¸ í•„ìš”</span>
                    <span class="profile-role" id="sb_userRole"></span>
                </div>
            </div>
            <button class="btn-logout-mini" onclick="adminLogout()">
                <i class="fa-solid fa-power-off"></i> ë¡œê·¸ì•„ì›ƒ
            </button>
        </div>

        <ul class="sidebar-menu">
            <li>
                <div class="menu-category" id="cat_groupCorp" onclick="toggleAdminMenu('groupCorp', this)">
                    <div><span class="menu-icon">ğŸ¢</span> ê¸°ì—…ìë¬¸ì„¼í„°</div>
                    <span style="font-size:10px;">â–¼</span>
                </div>
                <ul id="groupCorp" class="submenu">
                    <li><a href="/pages/admin/admin_members.html">ğŸ‘¥ íšŒì›/ê¸°ì—… ê´€ë¦¬</a></li>
                    <li><a href="/pages/admin/admin_staff_upload.html" style="color:#d46b08; font-weight:bold;">ğŸ“¥ ì§ì› ì¼ê´„ ë“±ë¡</a></li>
                    
                    <li><a href="/pages/admin/admin_payments.html">ğŸ’³ ë§¤ì¶œ/CMS ê´€ë¦¬</a></li>
                    <li><a href="/pages/admin/admin_corpbilling.html">ğŸ’¸ ìë¬¸ë£Œ ì²­êµ¬/ë°œì†¡</a></li>
                    
                    <li><a href="/pages/admin/admin.html">ğŸ“ ìë¬¸ ê´€ë¦¬ (ì „ì²´)</a></li>
                    <li><a href="/pages/admin/admin_requests.html">ğŸ“© ìš”ì²­ ê´€ë¦¬í•¨</a></li>
                    <li><a href="/pages/admin/admin_report.html">ğŸ“Š ë¦¬í¬íŠ¸ ë°œì†¡</a></li>
                </ul>
            </li>

            <li>
                <div class="menu-category" id="cat_groupCredit" onclick="toggleAdminMenu('groupCredit', this)">
                    <div><span class="menu-icon">ğŸ”</span> ì‹ ìš©/ì¬ì‚° ì¡°íšŒ (Biz)</div>
                    <span style="font-size:10px;">â–¼</span>
                </div>
                <ul id="groupCredit" class="submenu">
                    <li><a href="/pages/public/prompt_generator.html">ğŸ¤– AI í”„ë¡¬í”„íŠ¸ ë§¤ë‹ˆì €</a></li>
                    <li><a href="/pages/admin/admin_biz_corp_analysis.html">ğŸ¢ ë²•ì¸ ê¸°ì—…(ì‹ ìš©)/ë¶€ë™ì‚°ì •ë³´ ë¶„ì„</a></li>
                    <li><a href="/admin_biz_person_credit">ğŸ‘¤ ê°œì¸ ì‹ ìš©ì¡°íšŒ ë¶„ì„</a></li>
                    <li><a href="/admin_biz_person_corp">ğŸ­ ê°œì¸ ê¸°ì—…ì •ë³´ ë¶„ì„</a></li>
                    <li><a href="/admin_biz_realestate">ğŸ  ë¶€ë™ì‚° ì •ë³´ ë¶„ì„</a></li>
                    <li><a href="/admin_biz_report" style="color:#13c2c2; font-weight:bold;">ğŸ“ ìµœì¢…ë³´ê³ ì„œ ì‘ì„±</a></li>
                </ul>
            </li>

            <li>
                <div class="menu-category" id="cat_groupLitigation" onclick="toggleAdminMenu('groupLitigation', this)">
                    <div><span class="menu-icon">âš–ï¸</span> ì¢…í•©ì†Œì†¡ì„¼í„°</div>
                    <span style="font-size:10px;">â–¼</span>
                </div>
                <ul id="groupLitigation" class="submenu">
                    <li><a href="/pages/public/real_data_upload.html" style="color:#52c41a; font-weight:700;">ğŸ“¥ ì—‘ì…€ ë°ì´í„° ì—…ë¡œë“œ</a></li>
                    <li><a href="/pages/admin/admin_litigation.html">ğŸ” ì „ìì†Œì†¡ ë°ì´í„° í™•ì¸</a></li>
                    <li><a href="/pages/admin/admin_clients.html">ğŸ“‡ ë‹¹ì‚¬ì(ê³ ê°) ê´€ë¦¬</a></li>
                    <li><a href="/pages/admin/admin_submit.html">ğŸ“¤ ë¬¸ì„œ ì œì¶œ/ë°œì†¡</a></li>
                    <li><a href="/pages/admin/admin_billing.html">ğŸ’° ë¹„ìš©/ì²­êµ¬ ê´€ë¦¬</a></li>
                    <li><a href="/admin_casereport">ğŸ“¢ ì‚¬ê±´ ë¦¬í¬íŠ¸ ë°œì†¡</a></li>
                </ul>
            </li>

            <li>
                <div class="menu-category" id="cat_groupDebt" onclick="toggleAdminMenu('groupDebt', this)">
                    <div><span class="menu-icon">ğŸ”¨</span> ì¶”ì‹¬ì„¼í„°</div>
                    <span style="font-size:10px;">â–¼</span>
                </div>
                <ul id="groupDebt" class="submenu">
                    <li><a href="/pages/admin/admin_collection_consult.html">ğŸ’° ì±„ê¶Œ ì¶”ì‹¬ ìƒë‹´</a></li>
                    <li><a href="/pages/admin/admin_collection_task.html">âš¡ ì¶”ì‹¬ ì‚¬ê±´ ê´€ë¦¬ (Process)</a></li>
                </ul>
            </li>

            <li>
                <div class="menu-category" id="cat_groupPasan" onclick="toggleAdminMenu('groupPasan', this)">
                    <div><span class="menu-icon">ğŸ“‰</span> íŒŒì‚°/íšŒìƒì„¼í„°</div>
                    <span style="font-size:10px;">â–¼</span>
                </div>
                <ul id="groupPasan" class="submenu">
                    <li><a href="/index.html" style="color:#fff; font-weight:bold; background:rgba(255,255,255,0.1);">ğŸ  ì„¼í„° ë©”ì¸ (Index)</a></li>
                    <li><a href="/pages/admin/admin_pasan_consult.html">ğŸ“‰ íŒŒì‚°/íšŒìƒ ìƒë‹´</a></li>
                    <li><a href="/pages/admin/admin_pasan.html">ğŸ“‰ íŒŒì‚°/íšŒìƒ ì‚¬ê±´</a></li>
                    <li><a href="/passan/admin_auto_pasan" style="color:#722ed1; font-weight:700;">ğŸ¤– íšŒìƒ/íŒŒì‚° ìë™í™”</a></li>
                </ul>
            </li>

            <li>
                <div class="menu-category" id="cat_groupAuto" onclick="toggleAdminMenu('groupAuto', this)">
                    <div><span class="menu-icon">ğŸ¤–</span> ë¦¬ê±¸í…Œí¬/ìë™í™”</div>
                    <span style="font-size:10px;">â–¼</span>
                </div>
                <ul id="groupAuto" class="submenu">
                    <li><a href="/admin_auto_docs">ğŸ“ ì„œë©´ ì‘ì„± ìë™í™”</a></li>
                </ul>
            </li>

            <li>
                <div class="menu-category" id="cat_groupEtc" onclick="toggleAdminMenu('groupEtc', this)">
                    <div><span class="menu-icon">âš”ï¸</span> ë¶„ìŸ ë° ì¢…ê²°</div>
                    <span style="font-size:10px;">â–¼</span>
                </div>
                <ul id="groupEtc" class="submenu">
                    <li><a href="/pages/admin/admin_conflict.html" style="color:#fa8c16; font-weight:700;">âš”ï¸ ë¶„ìŸ/í˜‘ìƒ (Conflict)</a></li>
                    <li><a href="/pages/admin/admin_finished.html" style="color:#999; font-weight:700;">ğŸ ì¢…ê²° ì‚¬ê±´ (Archive)</a></li>
                </ul>
            </li>

            <li class="menu-divider"></li>

            <li>
                <div class="menu-category" id="cat_groupHR" onclick="toggleAdminMenu('groupHR', this)">
                    <div><span class="menu-icon">ğŸ¢</span> ì‚¬ë‚´ê´€ë¦¬</div>
                    <span style="font-size:10px;">â–¼</span>
                </div>
                <ul id="groupHR" class="submenu">
                    <li><a href="/admin_vacation">ğŸ“… ì—°ì°¨/íœ´ê°€ ì‹ ì²­ ë‚´ì—­</a></li>
                    <li><a href="/admin_hr_members">ğŸ“‡ ì‚¬ë‚´ ì§ì› ê´€ë¦¬</a></li>
                </ul>
            </li>

            <li>
                <div class="menu-category" onclick="location.href='/pages/admin/admin_finance.html"">
                    <div style="font-weight:bold;"><span class="menu-icon">ğŸ“Š</span> ê²½ì˜ê´€ë¦¬</div>
                </div>
            </li>

            <li><a href="/pages/admin/admin_settings.html" class="menu-category"><span class="menu-icon">âš™ï¸</span> ê¸°ì—…ìë¬¸ì„¼í„° í™˜ê²½ì„¤ì •</a></li>
            
            <li><a href="/pages/user/dashboard.html" class="menu-category"><span class="menu-icon">ğŸ–¥ï¸</span> ê³ ê° ëŒ€ì‹œë³´ë“œ ë³´ê¸°</a></li>

            <li><a href="/" class="menu-category"><span class="menu-icon">ğŸ </span> í™ˆí˜ì´ì§€ë¡œ ì´ë™</a></li>
            
            <li style="height:50px;"></li>
        </ul>
    </nav>
    `;

    document.body.insertAdjacentHTML('afterbegin', sidebarHTML);

    setTimeout(() => {
        const currentPath = window.location.pathname;
        const links = document.querySelectorAll('.submenu a');
        
        links.forEach(link => {
            const href = link.getAttribute('href');
            
            // í˜„ì¬ ì£¼ì†Œê°€ hrefë¥¼ í¬í•¨í•˜ê³  ìˆë‹¤ë©´ í™œì„±í™”
            if (currentPath.includes(href) && href !== '/' && href !== '#') {
                link.style.color = "#fff";
                link.style.fontWeight = "bold";
                link.style.backgroundColor = "#2c5bf2";
                link.style.borderRadius = "4px";

                const parentSubmenu = link.closest('.submenu');
                if (parentSubmenu) {
                    parentSubmenu.style.display = 'block';
                    const categoryId = "cat_" + parentSubmenu.id;
                    const categoryEl = document.getElementById(categoryId);
                    if(categoryEl) categoryEl.classList.add('active');
                }
            }
        });
    }, 50);
}

// (ì´í•˜ toggleAdminMenu, updateSidebarUser ë“± ê¸°ì¡´ í•¨ìˆ˜ ë™ì¼ ìœ ì§€)
window.toggleAdminMenu = function(id, header) {
    const submenu = document.getElementById(id);
    if (!submenu) return;
    
    if (submenu.style.display === "block") {
        submenu.style.display = "none";
        header.classList.remove("active");
    } else {
        submenu.style.display = "block";
        header.classList.add("active");
    }
};

window.updateSidebarUser = function(user, additionalData = {}) {
    if(!user) return;
    const nameEl = document.getElementById('sb_userName');
    const emailEl = document.getElementById('sb_userEmail');
    const roleEl = document.getElementById('sb_userRole');

    if(nameEl) nameEl.textContent = user.displayName || user.email.split('@')[0];
    if(emailEl) emailEl.textContent = user.email;
    
    if(roleEl) {
        if(additionalData.dept) roleEl.textContent = `${additionalData.dept} ${additionalData.position || ''}`;
        else roleEl.textContent = 'ê´€ë¦¬ì';
    }
};

window.adminLogout = function() {
    if(confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        if(window.auth) window.auth.signOut().then(() => location.href = '="/pages/public/login.html");
        else location.href = '="/pages/public/login.html";
    }
};